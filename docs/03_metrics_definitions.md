# VeloNorth - Business Metrics Definitions

This document specifies the calculation logic for the key business metrics used in both the **Power BI prototype** and the **Streamlit dashboard**.  
It ensures consistency and provides a **single source of truth** for all business logic.

---

## 1. Total Net Revenue (Completed Sales)

**Business Definition:**  
The total net revenue (excluding taxes) generated from sales orders that have a `LIFECYCLESTATUS = 'C'` (Completed).  
This represents the actual, recognized revenue.

**DAX (Power BI):**
```DAX
Total Net Revenue = 
CALCULATE(
    SUM(fact_sales[NETAMOUNT]),
    fact_sales[LIFECYCLESTATUS] = "C"
)
```

**Python (Streamlit):**
```python
completed_sales = filtered_sales[filtered_sales['LIFECYCLESTATUS'] == 'C']
total_revenue = completed_sales['NETAMOUNT'].sum()
```

---

## 2. Total Completed Orders

**Business Definition:**  
The total count of unique sales orders that have a `LIFECYCLESTATUS = 'C'` (Completed).

**DAX (Power BI):**
```DAX
Total Completed Orders = 
CALCULATE(
    DISTINCTCOUNT(fact_sales[SALESORDERID]),
    fact_sales[LIFECYCLESTATUS] = "C"
)
```

**Python (Streamlit):**
```python
completed_sales = filtered_sales[filtered_sales['LIFECYCLESTATUS'] == 'C']
total_orders = completed_sales['SALESORDERID'].nunique()
```

---

## 3. Average Order Value (AOV)

**Business Definition:**  
The average net revenue generated per completed order.

**DAX (Power BI):**
```DAX
Average Order Value = 
DIVIDE(
    [Total Net Revenue],
    [Total Completed Orders],
    0
)
```

**Python (Streamlit):**
```python
avg_order_value = total_revenue / total_orders if total_orders > 0 else 0
```

---

## 4. Total Quantity Sold (Completed)

**Business Definition:**  
The total number of individual items sold across all completed orders.

**DAX (Power BI):**
```DAX
Total Quantity Sold = 
CALCULATE(
    SUM(fact_sales[QUANTITY]),
    fact_sales[LIFECYCLESTATUS] = "C"
)
```

**Python (Streamlit):**
```python
completed_sales = filtered_sales[filtered_sales['LIFECYCLESTATUS'] == 'C']
total_quantity = completed_sales['QUANTITY'].sum()
```

---

## 5. Sales of Top Client

**Business Definition:**  
The total net revenue generated by the single customer with the highest overall sales within the selected period.

**DAX (Power BI):**
```DAX
Sales of Top Client = 
VAR TopClient =
    TOPN (
        1,
        VALUES ( dim_customer[COMPANYNAME] ),
        [Total Net Revenue],
        DESC
    )
RETURN
    CALCULATE (
        [Total Net Revenue],
        dim_customer[COMPANYNAME] IN TopClient
    )
```

**Python (Streamlit):**
```python
# In Streamlit this is calculated dynamically for the "Top 10 Customers" table.
top_customers = (
    filtered_sales
    .groupby('COMPANYNAME')['NETAMOUNT']
    .sum()
    .sort_values(ascending=False)
    .reset_index()
    .head(10)
)

# The top client's sales would be:
top_client_sales = top_customers.iloc[0]['NETAMOUNT']
```
